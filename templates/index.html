<!DOCTYPE html>
<html lang="en">
<head>    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='logo.png') }}">
    <title>INTOSPACE AI - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='space-animations.css') }}" rel="stylesheet">
    <style>
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .space-x-4 > * + * { margin-left: 1rem; }
        .space-x-2 > * + * { margin-left: 0.5rem; }
    </style>
</head>
<body class="bg-white min-h-screen text-black space-background" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);">
    <!-- Scan Line Effect -->
    <div class="scan-line"></div>
    
    <!-- Animated Satellite -->
    <div class="animated-satellite" style="top: 10%; left: 5%;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            <circle cx="12" cy="12" r="2"/>
        </svg>
    </div>
    
    <div x-data="agentSystem()" class="h-screen flex">
        <!-- Main Interface - Full Height Layout -->
        <div class="flex w-full h-full">            <!-- Agent Execution Log Panel (One Third Left Side - Full Height) -->
            <div class="w-1/3 bg-white flex flex-col h-full border-r-2 border-black relative overflow-hidden">
                <!-- Grid Overlay -->
                <div class="grid-overlay"></div>
                <!-- Terminal Header -->
                <div class="bg-white px-4 py-3 flex items-center justify-between border-b-2 border-black flex-shrink-0 shadow-sm slide-in pulse-glow">
                    <div class="flex items-center">

                        <h2 class="text-lg font-bold text-black flex items-center">
                            <i class="fas fa-terminal mr-2 text-black"></i>
                            Agent Terminal
                        </h2>
                    </div>                    <div class="flex space-x-2">                        <button @click="showAllJsonData()" 
                                class="bg-black text-white px-3 py-1 rounded text-xs hover:bg-gray-800 transition-colors border-2 border-black font-medium">
                            <i class="fas fa-code mr-1"></i>
                            JSON
                        </button>
                        <button @click="autoScroll = !autoScroll" 
                                :class="autoScroll ? 'bg-black text-white border-black' : 'bg-white text-black border-black'"
                                class="px-3 py-1 rounded text-xs hover:opacity-80 transition-all border-2 font-medium">
                            <i class="fas fa-arrow-down mr-1"></i>
                            <span x-text="autoScroll ? 'Auto-scroll' : 'Manual'"></span>
                        </button>
                        <button @click="clearLogs()" 
                                class="bg-gray-600 text-white px-3 py-1 rounded text-xs hover:bg-gray-700 transition-colors border-2 border-gray-600 font-medium">
                            <i class="fas fa-trash mr-1"></i>
                            Clear
                        </button>
                    </div>
                </div>
                
                <!-- Terminal Body -->
                <div class="flex-1 overflow-y-auto bg-white p-4 font-mono text-sm" 
                     id="terminal-output"
                     x-ref="terminalOutput">
                     
                    <!-- Welcome Message -->
                    <div x-show="logs.length === 0" class="text-center py-12 fade-in-up">
                        <div class="text-black text-6xl mb-4 float-animation">
                            <i class="fas fa-terminal"></i>
                        </div>
                        <div class="text-black text-xl mb-2 font-semibold">INTOSPACE AI Terminal</div>
                        <div class="text-gray-600 text-sm mb-4">Ready to execute agent workflows...</div>
                        <!-- Orbital Ring -->
                        <div class="orbital-ring mx-auto mt-8 opacity-30">
                            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                                <i class="fas fa-satellite text-black text-2xl"></i>
                            </div>
                        </div>
                        <div class="text-gray-500 text-xs">
                            <div class="mb-1">‚Ä¢ Real-time agent execution logs</div>
                            <div class="mb-1">‚Ä¢ Google ADK coordination tracking</div>
                            <div class="mb-1">‚Ä¢ API call monitoring</div>
                            <div>‚Ä¢ Error detection and reporting</div>
                        </div>
                    </div>
                    
                    <!-- System Status Header -->
                    <div x-show="logs.length > 0" class="border-b-2 border-black pb-2 mb-4">
                        <div class="text-black font-bold">
                            <i class="fas fa-robot mr-2"></i>MULTI-AGENT AI SYSTEM v1.0
                        </div>
                        <div class="text-gray-600 text-xs mt-1">
                            Session started: <span x-text="new Date().toLocaleString()"></span>
                        </div>
                    </div>
                    
                    <!-- Log Entries -->
                    <template x-for="(log, index) in logs" :key="index">
                        <div class="mb-2 flex items-start slide-in terminal-log-entry" 
                             :class="getLogClass(log.message)"
                             :style="'animation-delay: ' + (index * 0.05) + 's'">
                            <span class="text-gray-500 mr-3 text-xs flex-shrink-0 font-mono terminal-timestamp" 
                                  x-text="log.timestamp"></span>
                            <div class="flex-1 terminal-message">
                                <span :class="getMessageClass(log.message)" 
                                      x-html="formatLogMessage(log.message)"></span>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Live Status Indicator -->
                    <div x-show="loading || evaluationLoading" 
                         class="mt-4 p-3 bg-gray-100 rounded border-2 border-black">
                        <div class="text-black animate-pulse flex items-center font-medium">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            <span x-text="loading ? 'Executing agent workflow...' : 'Running system evaluation...'"></span>
                        </div>
                        <div class="text-gray-600 text-xs mt-1" x-text="getCurrentStatus()"></div>
                    </div>
                    
                    <!-- Command Prompt -->
                    <div x-show="!loading && !evaluationLoading && logs.length > 0" 
                         class="mt-4 flex items-center text-black">
                        <span class="mr-2 font-bold">$</span>
                        <span class="terminal-cursor">_</span>
                        <span class="ml-2 text-gray-500 text-xs">Ready for next command</span>
                    </div>
                </div>
                
                <!-- Terminal Footer -->
                <div class="bg-white px-4 py-2 border-t-2 border-black flex-shrink-0 shadow-sm">
                    <div class="flex justify-between items-center text-xs text-gray-700">
                        <div class="flex items-center space-x-4">
                            <span class="flex items-center">
                                <i class="fas fa-circle text-black mr-1 status-pulse"></i>
                                <span class="font-medium">Connected</span>
                            </span>
                            <span class="font-medium" x-text="'Logs: ' + logs.length"></span>
                            <span x-show="systemStatus?.latest_evaluation" class="font-medium">
                                ADK Confidence: <span x-text="systemStatus?.latest_evaluation?.average_confidence + '%'" class="text-black font-bold"></span>
                            </span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span>ADK Terminal v1.0</span>
                        </div>
                    </div>
                </div>
            </div>            <!-- Main Content (Right Side - Two Thirds Width) -->
            <div class="w-2/3 flex flex-col h-full overflow-y-auto bg-white">
                <!-- Header Section -->
                <div class="bg-white shadow-md p-6 flex-shrink-0 border-b-2 border-black relative overflow-hidden">
                    <!-- Grid Overlay -->
                    <div class="grid-overlay"></div>
                    <div class="flex items-center justify-between relative z-10">
                        <div class="fade-in-up">
                            <h1 class="text-3xl font-bold text-black flex items-center" style="letter-spacing: -0.02em;">
                                <i class="fas fa-brain mr-3 text-black"></i>
                                INTOSPACE AI
                            </h1>
                            <p class="text-gray-600 mt-2 font-medium">Google ADK-powered intelligent agent coordination</p>
                        </div>                        <div class="flex items-center space-x-4">
                            <div class="bg-black text-white px-3 py-1 rounded-full text-sm font-medium border-2 border-black">
                                <i class="fas fa-circle text-white mr-1"></i>
                                System Active
                            </div>
                            <a href="/chat" class="group relative bg-black text-white px-6 py-3 rounded-xl hover:bg-gray-900 transition-all duration-300 border-2 border-black hover:border-gray-700 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center justify-center space-x-2 min-w-[180px] space-hover button-ripple pulse-glow">
                                <i class="fas fa-comments text-lg text-white float-animation"></i>
                                <div class="flex flex-col items-start">
                                    <span class="text-sm font-bold leading-tight text-white">Chat</span>
                                    <span class="text-xs font-medium opacity-90 leading-tight text-white">Interface</span>
                                </div>
                                <i class="fas fa-arrow-right text-sm text-white opacity-0 group-hover:opacity-100 transform group-hover:translate-x-1 transition-all duration-300"></i>
                            </a>
                            <button @click="loadStatus()" class="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors border-2 border-black font-medium shadow-sm">
                                <i class="fas fa-sync-alt mr-2"></i>
                                Refresh Status
                            </button>
                        </div>
                    </div>
                </div>                <!-- System Metrics -->
                <div class="grid grid-cols-2 gap-2 p-3 bg-white border-b-2 border-black flex-shrink-0" x-show="systemStatus">
                    <div class="bg-gray-50 rounded-lg p-2 border-2 border-black">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-medium text-gray-600 uppercase tracking-wide">ADK Confidence</p>
                                <p class="text-lg font-bold text-black" x-text="systemStatus?.latest_evaluation?.average_confidence + '%'">--</p>
                            </div>
                            <i class="fas fa-brain text-black text-lg"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-2 border-2 border-black">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-medium text-gray-600 uppercase tracking-wide">Quality Score</p>
                                <p class="text-lg font-bold text-black" x-text="systemStatus?.latest_evaluation?.average_quality_score + '%'">--</p>
                            </div>
                            <i class="fas fa-star text-black text-lg"></i>
                        </div>
                    </div>
                </div>

                <!-- Scrollable Content Area -->
                <div class="flex-1 overflow-y-auto p-6 space-y-6">                    <!-- Goal Input Section -->
                    <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-black space-hover fade-in-up relative overflow-hidden">
                        <!-- Grid Overlay -->
                        <div class="grid-overlay"></div>
                        <h2 class="text-xl font-bold text-black mb-4 flex items-center" style="letter-spacing: -0.01em;">
                            <i class="fas fa-robot mr-2 text-black"></i>
                            Agent Goal Input
                        </h2>                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2 uppercase tracking-wide">Natural Language Goal</label>
                                <div class="flex space-x-3">
                                    <textarea 
                                        x-model="currentGoal"
                                        class="flex-1 p-3 border-2 border-black rounded-lg focus:ring-2 focus:ring-black focus:border-black bg-white text-black font-medium"
                                        rows="4"
                                        placeholder="Enter your goal in natural language...&#10;&#10;Example: Find the next SpaceX launch, check weather at that location, and summarize if it may be delayed."
                                    ></textarea>
                                    <div class="flex flex-col space-y-2">
                                        <button @click="runGoal()" 
                                                :disabled="loading || !currentGoal.trim()"
                                                :class="loading ? 'bg-gray-400' : 'bg-black hover:bg-gray-800'"
                                                class="text-white px-6 py-3 rounded-lg font-semibold transition-colors disabled:cursor-not-allowed whitespace-nowrap border-2 border-black shadow-sm button-ripple space-hover">
                                            <span x-show="!loading" class="flex items-center justify-center">
                                                <i class="fas fa-play mr-2"></i>
                                                Execute
                                            </span>
                                            <span x-show="loading" class="flex items-center justify-center">
                                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                                Executing...
                                            </span>
                                        </button>
                                        <button @click="runEvaluation()" 
                                                :disabled="evaluationLoading"
                                                :class="evaluationLoading ? 'bg-gray-400' : 'bg-black hover:bg-gray-800'"
                                                class="text-white px-6 py-3 rounded-lg font-semibold transition-colors disabled:cursor-not-allowed whitespace-nowrap border-2 border-black shadow-sm">
                                            <span x-show="!evaluationLoading">
                                                <i class="fas fa-flask mr-2"></i>
                                                Evaluate
                                            </span>
                                            <span x-show="evaluationLoading">
                                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                                Testing...
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Goal Templates -->
                            <div>
                                <p class="text-sm font-medium text-gray-700 mb-2 uppercase tracking-wide">Quick Templates:</p>                                <div class="grid grid-cols-3 gap-2">
                                    <button @click="currentGoal = 'Find the next SpaceX launch, check weather at that location, and summarize if it may be delayed.'" 
                                            class="text-center p-2 bg-gray-50 text-black rounded-lg hover:bg-gray-100 transition-colors border-2 border-black font-medium shadow-sm">
                                        <div class="font-semibold text-sm"><i class="fas fa-rocket mr-1"></i> SpaceX + Weather</div>
                                    </button>
                                    <button @click="currentGoal = 'Get information about the next SpaceX mission and launch details.'" 
                                            class="text-center p-2 bg-gray-50 text-black rounded-lg hover:bg-gray-100 transition-colors border-2 border-black font-medium shadow-sm">
                                        <div class="font-semibold text-sm"><i class="fas fa-space-shuttle mr-1"></i> SpaceX Mission</div>
                                    </button>
                                    <button @click="currentGoal = 'Check weather conditions at Kennedy Space Center for rocket launches.'" 
                                            class="text-center p-2 bg-gray-50 text-black rounded-lg hover:bg-gray-100 transition-colors border-2 border-black font-medium shadow-sm">
                                        <div class="font-semibold text-sm"><i class="fas fa-cloud-sun-rain mr-1"></i> Weather Analysis</div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>                    <!-- Results Section -->
                    <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-black">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-black flex items-center" style="letter-spacing: -0.01em;">
                                <i class="fas fa-chart-line mr-2 text-black"></i>
                                Execution Results
                            </h2>
                            <div class="space-x-2">
                                <button x-show="lastResult" 
                                        @click="downloadReport()"
                                        class="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors text-sm border-2 border-black font-medium shadow-sm">
                                    <i class="fas fa-file-download mr-2"></i>
                                    Download Report
                                </button>
                                <button x-show="lastResult" 
                                        @click="showAllJsonData()"
                                        class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm border-2 border-gray-600 font-medium shadow-sm">
                                    <i class="fas fa-code mr-2"></i>
                                    View Raw JSON
                                </button>
                            </div>
                        </div>
                        
                        <div x-show="!lastResult && !loading" class="text-center text-gray-500 py-8 fade-in-up">
                            <div class="orbital-ring mx-auto mb-6 opacity-30">
                                <i class="fas fa-robot text-4xl absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 float-animation"></i>
                            </div>
                            <p class="font-medium">Execute a goal to see results here</p>
                            <p class="text-sm mt-2 text-gray-600">Watch the terminal on the left for real-time execution logs</p>
                        </div>
                        
                        <div x-show="loading" class="text-center text-gray-500 py-8 fade-in-up">
                            <div class="space-spinner mx-auto mb-6"></div>
                            <p class="font-medium">Agents are working...</p>
                            <p class="text-sm mt-2 text-gray-600">Check the terminal for live progress updates</p>
                        </div>
                        
                        <div x-show="lastResult" class="space-y-4">
                            <!-- Final Summary -->
                            <div class="bg-gray-50 border-2 border-black rounded-lg p-4 space-hover fade-in-up pulse-glow">
                                <h3 class="font-semibold text-black mb-2 flex items-center">
                                    <i class="fas fa-target mr-2 float-animation"></i>
                                    Final Result
                                </h3>
                                <div class="text-gray-800 summary-content font-medium" x-html="formatSummary(lastResult?.result?.summary || lastResult?.result?.ai_summary)"></div>
                            </div>
                            
                            <!-- ADK Validation -->
                            <div x-show="lastResult?.result?.adk_validation" class="bg-gray-50 border-2 border-black rounded-lg p-4">
                                <h3 class="font-semibold text-black mb-3 flex items-center">
                                    <i class="fas fa-brain mr-2"></i>
                                    Google ADK Validation
                                </h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-white p-3 rounded border-2 border-black">
                                        <div class="text-sm text-gray-600 uppercase tracking-wide">Confidence Score</div>
                                        <div class="text-2xl font-bold text-black" x-text="lastResult?.result?.adk_validation?.confidence + '%'"></div>
                                    </div>
                                    <div class="bg-white p-3 rounded border-2 border-black">
                                        <div class="text-sm text-gray-600 uppercase tracking-wide">Quality Score</div>
                                        <div class="text-2xl font-bold text-black" x-text="lastResult?.result?.adk_validation?.quality_score + '%'"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Agent Status Cards -->
                            <div x-show="lastResult?.result?.agent_sequence" class="space-y-3">
                                <h3 class="font-semibold text-black flex items-center">
                                    <i class="fas fa-id-card mr-2"></i>
                                    Agent Status Cards
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <template x-for="agent in lastResult?.result?.agent_sequence" :key="agent">
                                        <div class="bg-gray-50 border-2 border-black rounded-lg p-3 shadow-sm">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="font-semibold text-black" x-text="formatAgentName(agent)"></div>
                                                <span class="text-xs px-2 py-1 rounded-full" :class="getAgentChipClass(agent)">
                                                    <span x-text="agent"></span>
                                                </span>
                                            </div>
                                            <p class="text-sm text-gray-700 whitespace-pre-line" x-text="lastResult?.result?.agent_outputs?.[agent] || 'Awaiting output'"></p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            
                            <!-- Agent Data Chain -->
                            <div class="space-y-3">
                                <h3 class="font-semibold text-black flex items-center">
                                    <i class="fas fa-sitemap mr-2"></i>
                                    Agent Data Pipeline
                                </h3>
                                <div class="space-y-2">
                                    <div x-show="lastResult?.result?.spacex" class="bg-gray-50 border-2 border-black rounded-lg p-3">
                                        <h4 class="font-semibold text-black text-sm flex items-center">
                                            <i class="fas fa-rocket mr-2"></i>
                                            SpaceX Agent Output
                                        </h4>
                                        <p class="text-sm text-gray-800 mt-1 font-medium" x-text="'Mission: ' + lastResult?.result?.spacex?.mission + ' at ' + lastResult?.result?.spacex?.coordinates?.name"></p>
                                    </div>
                                    <div x-show="lastResult?.result?.weather" class="bg-gray-50 border-2 border-black rounded-lg p-3">
                                        <h4 class="font-semibold text-black text-sm flex items-center">
                                            <i class="fas fa-cloud-sun mr-2"></i>
                                            Weather Agent Output
                                        </h4>
                                        <p class="text-sm text-gray-800 mt-1 font-medium" x-text="'Temperature: ' + lastResult?.result?.weather?.temperature + '¬∞C, Wind: ' + lastResult?.result?.weather?.wind_speed + ' m/s, Clouds: ' + lastResult?.result?.weather?.clouds + '%'"></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Execution Timeline -->
                            <div x-show="workflowLogs.length" class="bg-gray-50 border-2 border-black rounded-lg p-4">
                                <h3 class="font-semibold text-black mb-3 flex items-center">
                                    <i class="fas fa-stream mr-2"></i>
                                    Execution Timeline
                                </h3>
                                <div class="relative pl-4">
                                    <div class="absolute left-1 top-2 bottom-2 w-0.5 bg-black"></div>
                                    <template x-for="(log, idx) in workflowLogs" :key="idx">
                                        <div class="relative mb-4 pl-6">
                                            <div class="absolute left-0 top-1 w-3 h-3 rounded-full border-2 border-black" :class="getAgentColor(log.agent)"></div>
                                            <div class="text-xs text-gray-600" x-text="log.timestamp"></div>
                                            <div class="text-sm text-black font-medium" x-text="log.message"></div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Evaluation Results -->
                    <div x-show="evaluationResult" class="bg-white rounded-lg shadow-lg p-6 border-2 border-black">
                        <h2 class="text-xl font-bold text-black mb-4 flex items-center" style="letter-spacing: -0.01em;">
                            <i class="fas fa-chart-bar mr-2 text-black"></i>
                            System Evaluation Results
                        </h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-50 border-2 border-black rounded-lg p-4 text-center">
                                <h3 class="font-medium text-gray-700 uppercase tracking-wide">ADK Confidence</h3>
                                <p class="text-3xl font-bold text-black" x-text="evaluationResult?.average_confidence + '%'">--</p>
                            </div>
                            <div class="bg-gray-50 border-2 border-black rounded-lg p-4 text-center">
                                <h3 class="font-medium text-gray-700 uppercase tracking-wide">Quality Score</h3>
                                <p class="text-3xl font-bold text-black" x-text="evaluationResult?.average_quality_score + '%'">--</p>
                            </div>
                        </div>
                    </div>

                    <!-- System Diagram -->
                    <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-black">
                        <h2 class="text-xl font-bold text-black mb-4 flex items-center" style="letter-spacing: -0.01em;">
                            <i class="fas fa-project-diagram mr-2 text-black"></i>
                            System Workflow Diagram
                        </h2>
                        <p class="text-gray-700 text-sm mb-4 font-medium">Visual overview of how the planner coordinates specialized agents through planning ‚Üí execution ‚Üí synthesis.</p>
                        <div class="bg-gray-50 border-2 border-black rounded-lg p-4 flex justify-center">
                            <img src="/system-diagram" alt="System Workflow Diagram" class="max-h-96 object-contain">
                        </div>
                    </div>

                    <!-- Automation & Alerts -->
                    <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-black">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-black flex items-center" style="letter-spacing: -0.01em;">
                                <i class="fas fa-bell mr-2 text-black"></i>
                                Automation & Alerts
                            </h2>
                            <div class="text-sm text-gray-600 font-medium" x-text="schedules.enabled ? 'Scheduler active' : 'Scheduler disabled'"></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="border-2 border-black rounded-lg p-4 bg-gray-50">
                                <h3 class="font-semibold text-black mb-2 flex items-center">
                                    <i class="fas fa-clock mr-2"></i>
                                    Scheduled Goals
                                </h3>
                                <div x-show="!schedules.tasks.length" class="text-sm text-gray-600">
                                    No recurring goals configured. Update scheduler_config.json to add one.
                                </div>
                                <div x-show="schedules.tasks.length" class="space-y-3">
                                    <template x-for="task in schedules.tasks" :key="task.id">
                                        <div class="bg-white border-2 border-black rounded p-3 text-sm">
                                            <div class="font-semibold text-black" x-text="task.goal"></div>
                                            <div class="text-gray-700 mt-1 font-medium">Every <span x-text="formatInterval(task.interval_seconds)"></span></div>
                                            <div class="text-xs text-gray-600 mt-1">Next run: <span x-text="formatDate(task.next_run)"></span></div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div class="border-2 border-black rounded-lg p-4 bg-gray-50">
                                <h3 class="font-semibold text-black mb-2 flex items-center">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    Recent Notifications
                                </h3>
                                <div x-show="!notifications.length" class="text-sm text-gray-600">
                                    No notifications yet.
                                </div>
                                <div x-show="notifications.length" class="space-y-3">
                                    <template x-for="note in notifications" :key="note.id">
                                        <div class="bg-white border-2 border-black rounded p-3 text-sm">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="font-semibold text-black" x-text="note.title"></span>
                                                <span class="text-xs text-gray-600" x-text="formatDate(note.timestamp)"></span>
                                            </div>
                                            <p class="text-gray-700 font-medium" x-text="note.message"></p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><script>
        function agentSystem() {
            return {
                currentGoal: '',
                loading: false,
                evaluationLoading: false,
                lastResult: null,
                evaluationResult: null,
                systemStatus: null,
                logs: [],
                workflowLogs: [],
                notifications: [],
                schedules: { enabled: false, tasks: [] },
                autoScroll: true,

                getLogClass(message) {
                    if (message.includes('ERROR') || message.includes('failed')) return 'border-l-4 border-gray-500 pl-2';
                    if (message.includes('SUCCESS') || message.includes('completed')) return 'border-l-4 border-black pl-2';
                    if (message.includes('WARNING') || message.includes('Warning')) return 'border-l-4 border-gray-400 pl-2';
                    if (message.includes('ADK') || message.includes('Google ADK')) return 'border-l-4 border-black pl-2';
                    if (message.includes('SpaceX') || message.includes('spacex')) return 'border-l-4 border-black pl-2';
                    if (message.includes('Weather') || message.includes('weather')) return 'border-l-4 border-black pl-2';
                    return '';
                },

                getMessageClass(message) {
                    if (message.includes('ERROR') || message.includes('failed')) return 'text-gray-600';
                    if (message.includes('SUCCESS') || message.includes('completed')) return 'text-black';
                    if (message.includes('WARNING') || message.includes('Warning')) return 'text-gray-700';
                    if (message.includes('ADK') || message.includes('Google ADK')) return 'text-black';
                    if (message.includes('SpaceX') || message.includes('spacex')) return 'text-black';
                    if (message.includes('Weather') || message.includes('weather')) return 'text-black';
                    if (message.includes('Starting') || message.includes('Executing')) return 'text-gray-700';
                    if (message.includes('completed') || message.includes('finished')) return 'text-black';
                    return 'text-black';
                },

                formatLogMessage(message) {
                    // Add syntax highlighting for structured data
                    message = message.replace(/(\d+)%/g, '<span class="text-black font-bold">$1%</span>');
                    message = message.replace(/(\d+\.\d+)s/g, '<span class="text-gray-700">$1s</span>');
                    message = message.replace(/(https?:\/\/[^\s]+)/g, '<span class="text-black underline">$1</span>');
                    
                    // Highlight all agent names with better formatting
                    const agentPattern = /(spacex_agent|weather_agent|summary_agent|anomalies_detection_agent|satellite_data_agent|calculator_agent|dictionary_agent|news_agent|google_adk_agent)/g;
                    message = message.replace(agentPattern, 
                        '<span class="text-black font-semibold bg-gray-100 px-1.5 py-0.5 rounded border border-gray-300">$1</span>');
                    
                    // Highlight agent execution status - Running
                    message = message.replace(/üîÑ \[(\d+)\/(\d+)\] Running (\w+_agent)\.\.\./g, 
                        '<span class="text-blue-600 font-semibold">üîÑ [$1/$2] Running <span class="bg-blue-50 px-1.5 py-0.5 rounded border border-blue-200 animate-pulse">$3</span>...</span>');
                    
                    // Highlight agent execution status - Completed
                    message = message.replace(/‚úÖ (.*?)(spacex_agent|weather_agent|summary_agent|anomalies_detection_agent|satellite_data_agent|calculator_agent|dictionary_agent|news_agent|google_adk_agent)(.*?)completed|finished|has worked/gi, 
                        '<span class="text-green-600 font-semibold">‚úÖ $1<span class="bg-green-50 px-1.5 py-0.5 rounded border border-green-200">$2</span>$3<span class="text-green-600 font-bold">completed</span></span>');
                    
                    // Highlight status indicators
                    message = message.replace(/‚úÖ Output:/g, '<span class="text-green-600 font-semibold">‚úÖ Output:</span>');
                    message = message.replace(/‚ö†Ô∏è /g, '<span class="text-yellow-600 font-semibold">‚ö†Ô∏è </span>');
                    message = message.replace(/üöÄ Starting execution/g, '<span class="text-purple-600 font-semibold">üöÄ Starting execution</span>');
                    message = message.replace(/‚úÖ Goal execution completed/g, '<span class="text-green-600 font-bold text-lg">‚úÖ Goal execution completed</span>');
                    
                    // Highlight real-time keywords
                    message = message.replace(/\b(realtime|real-time)\b/gi, '<span class="text-blue-600 font-semibold bg-blue-50 px-1 rounded">$&</span>');
                    
                    // Highlight step indicators
                    message = message.replace(/üß† Step (\d+):/g, '<span class="text-purple-600 font-semibold">üß† Step $1:</span>');
                    message = message.replace(/‚öôÔ∏è Step (\d+):/g, '<span class="text-blue-600 font-semibold">‚öôÔ∏è Step $1:</span>');
                    message = message.replace(/üéØ Step (\d+):/g, '<span class="text-green-600 font-semibold">üéØ Step $1:</span>');
                    
                    return message;
                },

                showAllJsonData() {
                    // Update global data
                    window.agentSystemData = {
                        systemStatus: this.systemStatus,
                        lastResult: this.lastResult,
                        logs: this.logs,
                        evaluationResult: this.evaluationResult,
                        workflowLogs: this.workflowLogs
                    };
                    
                    // Call the global function
                    showAllJsonData();
                },

                formatAgentName(agent) {
                    return agent.replace('_', ' ').replace(/\b\w/g, c => c.toUpperCase());
                },

                formatAgentOutput(output) {
                    if (!output) return 'Awaiting output';
                    // Escape HTML first
                    let formatted = this.escapeHtml(output);
                    // Convert newlines to <br>
                    formatted = formatted.replace(/\n/g, '<br>');
                    // Highlight bullet points
                    formatted = formatted.replace(/^‚Ä¢ /gm, '<span class="text-black font-bold">‚Ä¢</span> ');
                    // Highlight emojis and status indicators
                    formatted = formatted.replace(/(üöÄ|üåç|üìù|üßÆ|üìñ|üì∞|üîç|üõ∞Ô∏è|‚úÖ|‚ö†Ô∏è|‚ùå)/g, '<span class="text-lg">$1</span>');
                    return formatted;
                },

                formatSummary(text) {
                    if (!text) return '';
                    
                    // Don't escape HTML first - we'll handle it more carefully
                    let formatted = String(text);
                    
                    // Convert markdown-style formatting to HTML
                    // Process in order to avoid conflicts
                    
                    // 1. Code blocks first (to protect them from other replacements)
                    formatted = formatted.replace(/`([^`]+)`/g, '<code class="bg-gray-200 px-1 py-0.5 rounded text-sm font-mono">$1</code>');
                    
                    // 2. Headers (before other text processing)
                    formatted = formatted.replace(/^### (.*$)/gm, '<h3 class="font-bold text-lg mt-4 mb-2 text-black">$1</h3>');
                    formatted = formatted.replace(/^## (.*$)/gm, '<h2 class="font-bold text-xl mt-4 mb-2 text-black">$1</h2>');
                    formatted = formatted.replace(/^# (.*$)/gm, '<h1 class="font-bold text-2xl mt-4 mb-2 text-black">$1</h1>');
                    
                    // 3. Bold: **text** - handle multiple patterns
                    // Pattern 1: **text** (standard)
                    formatted = formatted.replace(/\*\*([^*\n]+?)\*\*/g, '<strong class="font-bold text-black">$1</strong>');
                    // Pattern 2: ** text ** (with spaces)
                    formatted = formatted.replace(/\*\*\s+([^*\n]+?)\s+\*\*/g, '<strong class="font-bold text-black">$1</strong>');
                    // Pattern 3: **text (unclosed at end of line)
                    formatted = formatted.replace(/\*\*([^*\n]+?)$/gm, '<strong class="font-bold text-black">$1</strong>');
                    // Pattern 4: text** (unclosed at start)
                    formatted = formatted.replace(/^([^*\n]+?)\*\*/gm, '<strong class="font-bold text-black">$1</strong>');
                    
                    // 4. Bold: __text__ (alternative syntax)
                    formatted = formatted.replace(/__([^_\n]+?)__/g, '<strong class="font-bold text-black">$1</strong>');
                    
                    // 5. Remove ALL remaining ** (aggressive cleanup)
                    formatted = formatted.replace(/\*\*/g, '');
                    formatted = formatted.replace(/__/g, '');
                    
                    // 6. Bullet points: - item or ‚Ä¢ item
                    formatted = formatted.replace(/^[-‚Ä¢] (.*$)/gm, '<li class="ml-4 list-disc">$1</li>');
                    
                    // 7. Numbered lists: 1. item
                    formatted = formatted.replace(/^\d+\. (.*$)/gm, '<li class="ml-4 list-decimal">$1</li>');
                    
                    // 8. Wrap consecutive <li> tags in <ul> or <ol>
                    formatted = formatted.replace(/(<li class="ml-4 list-disc"[^>]*>.*?<\/li>(?:\s*<li class="ml-4 list-disc"[^>]*>.*?<\/li>)*)/gs, '<ul class="list-disc ml-6 my-2">$1</ul>');
                    formatted = formatted.replace(/(<li class="ml-4 list-decimal"[^>]*>.*?<\/li>(?:\s*<li class="ml-4 list-decimal"[^>]*>.*?<\/li>)*)/gs, '<ol class="list-decimal ml-6 my-2">$1</ol>');
                    
                    // 9. Horizontal rules: ---
                    formatted = formatted.replace(/^---$/gm, '<hr class="my-4 border-gray-300">');
                    
                    // 10. Escape HTML (but preserve our generated tags)
                    // First, temporarily replace our HTML tags
                    const placeholders = {};
                    let placeholderIndex = 0;
                    formatted = formatted.replace(/<(strong|em|h1|h2|h3|ul|ol|li|code|hr|br)([^>]*?)>/gi, (match) => {
                        const key = `__HTML_TAG_${placeholderIndex}__`;
                        placeholders[key] = match;
                        placeholderIndex++;
                        return key;
                    });
                    formatted = formatted.replace(/<\/(strong|em|h1|h2|h3|ul|ol|li|code|hr|br)>/gi, (match) => {
                        const key = `__HTML_TAG_${placeholderIndex}__`;
                        placeholders[key] = match;
                        placeholderIndex++;
                        return key;
                    });
                    
                    // Now escape HTML
                    formatted = this.escapeHtml(formatted);
                    
                    // Restore our HTML tags
                    for (const [key, value] of Object.entries(placeholders)) {
                        formatted = formatted.replace(key, value);
                    }
                    
                    // 11. Line breaks
                    formatted = formatted.replace(/\n/g, '<br>');
                    
                    // 12. Clean up multiple consecutive <br> tags
                    formatted = formatted.replace(/(<br>\s*){3,}/g, '<br><br>');
                    
                    // 13. Final aggressive cleanup: remove any remaining ** or __
                    formatted = formatted.replace(/\*\*/g, '');
                    formatted = formatted.replace(/__/g, '');
                    formatted = formatted.replace(/\*\s*\*/g, '');
                    formatted = formatted.replace(/_\s*_/g, '');
                    
                    return formatted;
                },

                escapeHtml(text) {
                    if (!text) return '';
                    return text
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#39;');
                },

                getAgentChipClass(agent) {
                    const colors = {
                        spacex_agent: 'bg-gray-100 text-black border-2 border-black',
                        weather_agent: 'bg-gray-100 text-black border-2 border-black',
                        summary_agent: 'bg-gray-100 text-black border-2 border-black',
                        calculator_agent: 'bg-gray-100 text-black border-2 border-black',
                        dictionary_agent: 'bg-gray-100 text-black border-2 border-black',
                        news_agent: 'bg-gray-100 text-black border-2 border-black'
                    };
                    return colors[agent] || 'bg-gray-100 text-black border-2 border-black';
                },

                getAgentColor(agent) {
                    if (agent === 'spacex') return 'bg-black';
                    if (agent === 'weather') return 'bg-black';
                    if (agent === 'summary') return 'bg-black';
                    if (agent === 'google_adk') return 'bg-black';
                    return 'bg-gray-600';
                },

                formatInterval(seconds) {
                    if (!seconds) return 'N/A';
                    if (seconds < 60) return `${seconds}s`;
                    if (seconds < 3600) return `${Math.round(seconds / 60)} min`;
                    return `${Math.round(seconds / 3600)} hr`;
                },

                formatDate(dateString) {
                    if (!dateString) return 'Pending';
                    return new Date(dateString).toLocaleString();
                },

                async downloadReport() {
                    try {
                        const response = await fetch('/api/report/latest');
                        if (!response.ok) throw new Error('No report available');
                        const data = await response.json();
                        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `multi-agent-report-${Date.now()}.json`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    } catch (error) {
                        alert(error.message);
                    }
                },

                getCurrentStatus() {
                    if (this.loading) {
                        return 'Coordinating multi-agent workflow execution...';
                    }
                    if (this.evaluationLoading) {
                        return 'Running comprehensive system evaluation tests...';
                    }
                    return 'System ready';
                },

                async runGoal() {
                    if (!this.currentGoal.trim()) return;
                    
                    this.loading = true;
                    this.lastResult = null;
                    this.logs = [];
                    this.workflowLogs = [];
                    
                    // Add initial log entry
                    this.logs.push({
                        timestamp: new Date().toLocaleTimeString(),
                        message: 'Initializing multi-agent workflow...',
                        type: 'info'
                    });
                    
                    try {
                        const response = await fetch('/api/run_goal', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                goal: this.currentGoal
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.lastResult = data;
                            this.workflowLogs = data.workflow_logs || [];
                            this.logs = data.logs || [];
                            this.logs.push({
                                timestamp: new Date().toLocaleTimeString(),
                                message: 'Workflow execution completed successfully!',
                                type: 'success'
                            });
                            this.fetchNotifications();
                            this.fetchSchedules();
                        } else {
                            this.logs = data.logs || [];
                            this.workflowLogs = data.workflow_logs || [];
                            this.logs.push({
                                timestamp: new Date().toLocaleTimeString(),
                                message: `Execution failed: ${data.error}`,
                                type: 'error'
                            });
                            alert('Error: ' + data.error);
                        }
                        
                        this.scrollToBottom();
                    } catch (error) {
                        this.logs.push({
                            timestamp: new Date().toLocaleTimeString(),
                            message: `Network error: ${error.message}`,
                            type: 'error'
                        });
                        alert('Network error: ' + error.message);
                    } finally {
                        this.loading = false;
                    }
                },

                async runEvaluation() {
                    this.evaluationLoading = true;
                    this.evaluationResult = null;
                    this.logs = [];
                    
                    // Add initial log entry
                    this.logs.push({
                        timestamp: new Date().toLocaleTimeString(),
                        message: 'Starting comprehensive system evaluation...',
                        type: 'info'
                    });
                    
                    try {
                        const response = await fetch('/api/evaluate', {
                            method: 'POST'
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.evaluationResult = data.evaluation;
                            this.logs = data.logs || [];
                            this.logs.push({
                                timestamp: new Date().toLocaleTimeString(),
                                message: 'System evaluation completed successfully!',
                                type: 'success'
                            });
                            
                            // Refresh system status to show updated metrics
                            await this.loadStatus();
                            
                            // Scroll to evaluation results section
                            this.$nextTick(() => {
                                const evalSection = document.querySelector('[x-show="evaluationResult"]');
                                if (evalSection) {
                                    evalSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            });
                        } else {
                            this.logs = data.logs || [];
                            this.logs.push({
                                timestamp: new Date().toLocaleTimeString(),
                                message: `Evaluation failed: ${data.error}`,
                                type: 'error'
                            });
                            alert('Evaluation error: ' + data.error);
                        }
                        
                        this.scrollToBottom();
                    } catch (error) {
                        this.logs.push({
                            timestamp: new Date().toLocaleTimeString(),
                            message: `Network error: ${error.message}`,
                            type: 'error'
                        });
                        alert('Network error: ' + error.message);
                    } finally {
                        this.evaluationLoading = false;
                    }
                },

                async clearLogs() {
                    try {
                        await fetch('/api/clear_logs', { method: 'POST' });
                        this.logs = [];
                    } catch (error) {
                        console.error('Failed to clear logs:', error);
                    }                },

                scrollToBottom() {
                    if (this.autoScroll) {
                        this.$nextTick(() => {
                            const terminal = this.$refs.terminalOutput;
                            if (terminal) {
                                terminal.scrollTop = terminal.scrollHeight;
                            }
                        });
                    }
                },

                async loadStatus() {
                    try {
                        const response = await fetch('/api/agent_status');
                        const data = await response.json();
                        this.systemStatus = data;
                    } catch (error) {
                        console.error('Failed to load status:', error);
                    }
                },

                async fetchNotifications() {
                    try {
                        const response = await fetch('/api/notifications');
                        const data = await response.json();
                        this.notifications = data.notifications || [];
                    } catch (error) {
                        console.error('Failed to fetch notifications:', error);
                    }
                },

                async fetchSchedules() {
                    try {
                        const response = await fetch('/api/schedules');
                        const data = await response.json();
                        this.schedules = data;
                    } catch (error) {
                        console.error('Failed to fetch schedules:', error);
                    }
                },

                init() {
                    this.loadStatus();
                    this.fetchNotifications();
                    this.fetchSchedules();
                    
                    // Watch for log changes and auto-scroll
                    this.$watch('logs', () => {
                        this.scrollToBottom();
                    });

                    setInterval(() => this.fetchNotifications(), 15000);
                    setInterval(() => this.fetchSchedules(), 60000);
                }            }
        }

        // JSON Modal functionality
        function showAllJsonData() {
            const modal = document.getElementById('jsonModal');
            const jsonContent = document.getElementById('jsonContent');
            
            // Get all JSON data from system status and last result
            const allJsonData = {
                systemStatus: window.agentSystemData?.systemStatus || null,
                lastResult: window.agentSystemData?.lastResult || null,
                logs: window.agentSystemData?.logs || []
            };
            
            jsonContent.textContent = JSON.stringify(allJsonData, null, 2);
            modal.classList.remove('hidden');
        }

        function hideJsonModal() {
            document.getElementById('jsonModal').classList.add('hidden');
        }
    </script>

    <!-- JSON Modal -->
    <div id="jsonModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" onclick="hideJsonModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[80vh] overflow-hidden border-2 border-black" onclick="event.stopPropagation()">
                <div class="bg-white text-black px-6 py-4 flex items-center justify-between border-b-2 border-black">
                    <h3 class="text-lg font-bold flex items-center" style="letter-spacing: -0.01em;">
                        <i class="fas fa-code mr-2"></i>
                        All JSON Data
                    </h3>
                    <button onclick="hideJsonModal()" class="text-gray-700 hover:text-black transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[60vh] bg-gray-50">
                    <pre id="jsonContent" class="bg-white p-4 rounded-lg text-sm font-mono whitespace-pre-wrap overflow-x-auto text-black border-2 border-black"></pre>
                </div>
                <div class="bg-white px-6 py-3 flex justify-end space-x-3 border-t-2 border-black">
                    <button onclick="copyJsonToClipboard()" class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 transition-colors border-2 border-black font-medium shadow-sm">
                        <i class="fas fa-copy mr-2"></i>
                        Copy to Clipboard
                    </button>
                    <button onclick="hideJsonModal()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors border-2 border-gray-600 font-medium shadow-sm">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variable to store agent system data
        window.agentSystemData = {};

        // Copy JSON to clipboard functionality
        function copyJsonToClipboard() {
            const jsonContent = document.getElementById('jsonContent').textContent;
            navigator.clipboard.writeText(jsonContent).then(function() {
                // Show temporary success message
                const button = event.target.closest('button');
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check mr-2"></i>Copied!';
                button.classList.remove('bg-white', 'hover:bg-gray-300');
                button.classList.add('bg-gray-600');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-gray-600');
                    button.classList.add('bg-white', 'hover:bg-gray-300');
                }, 2000);
            }).catch(function(err) {
                console.error('Could not copy text: ', err);
            });
        }
    </script>
</body>
</html>
